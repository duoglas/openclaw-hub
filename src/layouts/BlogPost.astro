---
import BaseLayout from './BaseLayout.astro';
import ArticleFeedback from '../components/ArticleFeedback.astro';
import Giscus from '../components/Giscus.astro';
import type { CollectionEntry } from 'astro:content';

type Props = CollectionEntry<'blog'>['data'] & {
  slug?: string;
};
const { title, description, pubDate, updatedDate, tags, lang = 'en', slug } = Astro.props;

const isZh = lang === 'zh';
const dateLocale = isZh ? 'zh-CN' : 'en-US';

// Build alternate URL
const otherLang = isZh ? 'en' : 'zh';
const baseSlug = slug || '';
const alternateUrl = `/${otherLang}/blog/${baseSlug}/`;
---
<BaseLayout title={title} description={description} lang={lang} alternateUrl={alternateUrl} alternateLang={otherLang}>
  <article class="card">
    <h1>{title}</h1>
    <div class="meta">
      <time datetime={pubDate.toISOString()}>{pubDate.toLocaleDateString(dateLocale, { year: 'numeric', month: 'long', day: 'numeric' })}</time>
      {updatedDate && <span> · {isZh ? '更新于' : 'Updated'} <time datetime={updatedDate.toISOString()}>{updatedDate.toLocaleDateString(dateLocale, { year: 'numeric', month: 'long', day: 'numeric' })}</time></span>}
    </div>
    <div class="tags">
      {tags.map(tag => <a href={`/${lang}/blog/tag/${tag}/`}><span class="tag">{tag}</span></a>)}
    </div>
    <slot />

    <ArticleFeedback lang={lang} slug={slug} />
    <Giscus lang={lang} />
  </article>
</BaseLayout>

<style>
  .meta {
    color: var(--text-muted);
    margin: 0.5rem 0 1rem;
    font-size: 0.9rem;
  }
  .tags {
    margin-bottom: 1rem;
  }
  .tags a {
    text-decoration: none;
  }
  .monetization-box p {
    color: var(--text-muted);
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
  }
  .monetization-box ul {
    margin-left: 1.2rem;
  }
  .monetization-box li {
    margin: 0.4rem 0;
  }
</style>
